<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
    "http://www.w3.org/TR/html4/strict.dtd">

<html>
<head>
        <title>Anders Conbere's 
Meat Flappings - Igor Design Part 2
</title>
        <link rel="alternate" type="application/atom+xml" href="feed.atom" title="Meat Flappings - Feed">

        <link rel="stylesheet" type="text/css" media="screen" href="http://anders.conbere.org/media/css/base.css">
        <link rel="stylesheet" type="text/css" media="screen" href="http://anders.conbere.org/media/css/reset.css">
        <link rel="stylesheet" type="text/css" media="screen" href="http://anders.conbere.org/media/css/main.css">
        <link rel="stylesheet" type="text/css" media="screen" href="http://anders.conbere.org/media/css/fonts.css">
</head>

<body>
    <div id="header">
        
        <h3><a href="/">&lt;- Take me home</a></h3>
        <h1><a href="http://anders.conbere.org/blog/">Meat Flappings</a></h1>
        
    </div>

    <div id="content">
        
<div class="post">
    
    <div class="meta">
        <h3 id="document_title"><a href="http://anders.conbere.org/blog/2011/05/03/igor_design_part_2">Igor Design Part 2</a></h3>
        <p>Published on: <span class="published_on">2011-05-03 by Anders Conbere</span></p>
    </div>
    <div class="post_body">
    <p>In the <a href="http://anders.conbere.org/blog/2009/08/22/concatinative_versus_object_oriented_design/">last post</a> on Igor I was describing some struggles I was having with an internal urge to make better use of python's generators in Igor by building a concatinative design. Really the discussion devolved into a rant about some issues I was having, and I just wanted to do an update and say that I've solved some of them.</p>
<p>The first thing that I noticed was that I could dramatically simplify the pieces by putting all of the path management into the Config class. Not only does this make sense in the grand scheme of things (paths are actually part of the config) but it meant that opposed to spreading that work out over many functions, it was all nicely self contained where it mattered. The result is that the publish function is nearly half the weight of what it used to be.</p>
<pre><code>def publish(source, destination=""):
    config = Config(source, destination)

    posts = make_posts(config.posts_dir, extensions=list(markup.extensions()))
    HomePage(posts), Feed(posts), Archive(posts)

    context = dict(documents = Document.all(), **config)

    publisher = Publisher(config.destination, config.templates_dir, context)
    [publisher.publish(d) for d in Document.all()]

    copy_supporting_files(config.source, config.destination)
</code></pre>
<p>versus...</p>
<pre><code>def publish(source, destination=""):
    paths = prepare_paths(source, destination)
    config = Config(paths['source'])

    paths['destination'] = paths['destination'] or config.get("publish_directory")
    assert(paths['destination'], "A destination directory is required")

    posts_path = path.join(paths['destination'], config.get("posts_prefix"))
    prepare_destination(paths['destination'])

    posts = find_posts(paths['source'], prefix=posts_dir, extensions=list(markup.extensions()))
    docs = posts + [HomePage(posts), Feed(posts), Archive(posts)]

    print(config)
    context = {'documents': documents}
    context.update(config)

    env = environment(paths['templates'], global_context=context)
    [write(doc, env, posts_path) for doc in docs]
    copy_supporting_files(paths['source'], paths['destination'])
</code></pre>
<p>Now I'm starting to feel good about this. My next goal is to abstract the source control tools being used. While my focuse is on Git, having it tightly bound seems like a bit of a cludge. And I suspect it will simplify some of the complexity found in the published_date, author, email etc. functions.</p>
    </div>
</div>

    </div>

    
    

    <div id="footer">
        
        <p>Generated with love by <a href="http://github.com/aconbere/igor/">Igor</a></p>
        
    </div>

    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-2522671-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>
    
    
    
</body>
</html>